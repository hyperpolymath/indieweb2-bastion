# ... (Builder stage remains the same)

# Runtime
FROM cgr.dev/chainguard/wolfi-base:latest
RUN apk add --no-cache deno ca-certificates libcap

WORKDIR /app
COPY --from=builder /app/src/scripts/*.bs.js ./dist/

# Create cert directory (Expects volume mount at runtime)
RUN mkdir -p /app/certs

# Grant bind permission
RUN setcap 'cap_net_bind_service=+ep' $(readlink -f $(which deno))

USER nonroot

# RSR: Expose TCP (HTTP/1.1, H2) and UDP (H3/QUIC)
EXPOSE 443/tcp
EXPOSE 443/udp

CMD ["deno", "run", "--allow-net", "--allow-read", "dist/Bastion.bs.js"]
